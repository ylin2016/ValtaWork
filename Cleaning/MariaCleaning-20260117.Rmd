---
title: "Reconciling Maria's Cleaning Cost"
author: "Yi Lin"
date: "2026-01-17"
knit: (function(input, encoding) {
  rmarkdown::render(input, 
  	encoding=encoding,
   output_dir="/Users/ylin/My Drive/Cohost/Data and Reporting/05-Cleaning")})
output: 
  html_document:
    toc: true # table of content true
    toc_float: true
    toc_depth: 3  # upto three depths of headings (specified by #, ## and ###)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F,warning = F,message = F)
library(plyr)
library(dplyr)
library(tidyr)
library(openxlsx)
library(lubridate)
library(scales)
library(ggplot2)
library(knitr)
library(kableExtra)
library(ggbreak)
library(slider)
library(plotly)
library(DT)
library(gridExtra)
options(knitr.kable.NA = "")
source('/Users/ylin/ValtaWork/Data and Reporting/R/DataProcess.R')
guesty_bookings = import_data() %>% 
  filter(!Listing %in% c("Bellevue 4551","Bothell 21833","NorthBend 44406",
                         "Ashford 137","Auburn 29123","Hoquiam 21")) %>%
  mutate(Listing = ifelse(Listing %in% "Ocean Spray 3","Cottage 3",Listing))
# Set working directory
#setwd("/Users/ylin/My Drive/Cohost/Data and Reporting/05-Cleaning/MariaCleaningCost")
```

# Executive Summary

This report analyzes Maria's cleaning service operations for our property management business. The analysis covers the period from January to August 2025, examining both Short-Term Rental (STR) and Residential cleaning services to ensure accurate payment reconciliation and identify operational insights.

It focuses on reconciling key data sources as follows:

-   **Cleaning Income data**: we collect Short-Term Rental cleaning fee from Guesty checkout records and Residential cleaning services.
-   **Cleaner Payout records**: Individual cleaner payment tracking
-   **Maria's dispatch cards**: Service scheduling and logistics
-   **Valta payout records**: Valta payment records from Maria's cleaning payment spreadsheet across multiple months [Maria cleaning payment process.xlsx](https://docs.google.com/spreadsheets/d/1DYndAEzV1V4vLXVcGs8IVoZY-jrIYGuPBpZpH68DDKQ/edit?gid=1399659903#gid=1399659903)

```{r monthly-payout,echo = F,warning = F,message = F}
load("/Users/ylin/Google Drive/My Drive/Data and Reporting/05-Cleaning/MariaCleaningCost/DispatchCardData-20260117.Rdata")
months = c(paste0("2025-0",6:9),paste0("2025-",10:12))
start_date = '2025-06-01'
end_date = '2025-12-31'
data = data %>% filter(Cleaning.Date>=start_date & Cleaning.Date<=end_date)

cleaner_paids = data %>% 
      group_by(Cleaning.Date,cleaner,Rate) %>% 
      reframe(Units=n(),nSTR=length(unique(Listing[!Type %in% "Residential"])),
              income=sum(cleaner_income,na.rm=T),
              incomeSTR=sum(cleaner_income[!Type %in% "Residential"],na.rm=T),
              incomeResid=sum(cleaner_income[Type %in% "Residential"],na.rm=T),
              missing = sum(is.na(cleaner_income)))

property_costs = data %>% 
  group_by(Cleaning.Date,Listing,CleaningIncome) %>% 
  reframe(ncleaner=n(),Cost=sum(cleaner_paid,na.rm=T),
          missing = sum(is.na(cleaner_income)))

car_arrange = data %>% mutate(Car=substr(Car.arrange,1,4)) %>%
        group_by(Cleaning.Date,Car) %>%
        reframe(ncleaner = length(unique(cleaner)),
                #nUnits = length(unique(Listing)),
                Income=sum(CleaningIncome,na.rm=T),
                Cost=sum(cleaner_income,na.rm=T))

Incomes = merge(property_costs %>% group_by(Cleaning.Date) %>% 
  reframe(propertyIncome = sum(CleaningIncome)),
  cleaner_paids %>% group_by(Cleaning.Date) %>% 
    reframe(cleanerIncome = sum(income)),by="Cleaning.Date",all=T)

#Incomes %>% filter(abs(propertyIncome-cleanerIncome)>0.01)

```

# Monthly Payout Summary

```{r monthly-summary,echo = F,warning = F,message = F}
## pay cleaners
paid = payCleaner %>% group_by(yearmonth) %>% reframe(payCleaner= sum(Rate,na.rm=T))

## Monthly Income
monthly = Incomes_monthly %>% 
  filter(yearmonth %in% months) %>%
  group_by(yearmonth) %>% 
  mutate(CleaningIncome=as.numeric(CleaningIncome)) %>%
  reframe(STR = sum(CleaningIncome[Type %in% "STR"],na.rm=T),
          Residential = sum(CleaningIncome[Type %in% "Residential"],na.rm=T),
          CleaningIncome=sum(CleaningIncome,na.rm=T))

monthly = merge(monthly,paid,by='yearmonth',all.x=T)
monthly = merge(monthly,Valtapay,by='yearmonth',all=T) %>%
   filter(yearmonth %in% months) 
 

total_row <- monthly %>% filter(yearmonth %in% months) %>%
  summarise(
    yearmonth = "Total", # Label for the total row
    across(where(is.numeric), sum,na.rm=T) # Sum all numeric columns
  )

monthly = rbind(monthly %>% filter(yearmonth %in% months),total_row)
monthly %>% 
  kable(digits = 2,caption="") %>%
  kable_styling(full_width =F, position = "left") %>%
  row_spec(nrow(monthly), bold = TRUE,hline_after = T)
```

We create a comprehensive daily summary of Maria's cleaning activities. Note that the payment_ratio = CleanerPayout/CleaningFee.

0. Daily based on Guesty checkout to get totalwt to clean:

```{r daily-summary}
# Generate daily cleaning summary via Guesty records for Maria from June 2025 onwards
daily = data %>% 
  filter(Cleaning.Date >= start_date & Cleaning.Date <= end_date) %>% 
  filter(!duplicated(paste(Cleaning.Date,Listing))) %>%
  group_by(Cleaning.Date) %>%
  reframe(units = n(),
          units_residential = sum(Type %in% "Residential"),
          CleaningIncome = sum(CleaningIncome, na.rm = T),
          CleaningIncome.STR = sum(Cleaning.fee, na.rm = T),
  CleaningIncome.Residential = sum(residential.fee, na.rm = T),
          totalweight.STR = sum(wt.sum,na.rm=T)) 

# Create weekly groupings (Friday-ending weeks)
fridays = weekdays(daily$Cleaning.Date)
fridays = daily$Cleaning.Date[fridays %in% "Friday"]
fridays = c(fridays[1] - 7, fridays, fridays[length(fridays)] + 7)
daily$Week = cut(daily$Cleaning.Date, breaks = fridays, right = T)
levels(daily$Week) = fridays[-1]

# Merge with actual payment data
daily = merge(daily, payCleaner %>% 
                group_by(Week, Day) %>% 
                reframe(CleaningCost = sum(Rate,na.rm=T)),
              by.x = 'Cleaning.Date', by.y = 'Day', suffix = c("", ".pay")) %>%
  mutate(yearmonth= substr(Cleaning.Date, 1, 7),
         CleaningCost_cumsum = unlist(tapply(CleaningCost, yearmonth, cumsum)),
         CleaningIncome_cumsum = unlist(tapply(CleaningIncome, yearmonth, cumsum)),
         CleaningIncome_STR_cum = unlist(tapply(CleaningIncome.STR, yearmonth, cumsum)),
         CleaningIncome_Residential_cum = unlist(tapply(CleaningIncome.Residential, yearmonth, cumsum)))

# Calculate summary statistics
summary_stats = daily %>% 
    reframe(
    Days = n(),
    Total_Units = sum(units, na.rm = TRUE),
    STR_Units = sum(units - units_residential, na.rm = TRUE),
    Residential_Units = sum(units_residential, na.rm = TRUE),
    CleaningIncome = sum(CleaningIncome, na.rm = TRUE),
    CleaningCost = sum(CleaningCost, na.rm = TRUE),
    Loads_15lb.STR = sum(totalweight.STR,na.rm=T)/15,
    delta_income_cost = round(CleaningIncome -CleaningCost,2),
    Cost_perc = paste0(round(CleaningCost/CleaningIncome*100,2),"%"),
    AvgCleaningCost_perUnit = round(CleaningCost/Total_Units,2)) %>%
  mutate(Avg_cleanings_per_day = round(Total_Units/Days))
```

Monthly comparison: using Maria's payout records, which is adjusted Guesty records.

Note that laundry weights for short term rental cleaning is calculated as following:

Sheets (variable by bed type) + Towels (1.7 lbs/guest) + Pet blankets (all quilts in the room variable by bed type)

and assume 1 load = 15 lbs

```{r monthly-breakdown}
monthly_load = daily %>% group_by(yearmonth,Cleaning.Date) %>%
    reframe(Loads_15lb.STR = sum(totalweight.STR,na.rm=T)/15) %>%
  group_by(yearmonth) %>%
  reframe(Loads_total_15lb.STR = round(sum(Loads_15lb.STR)),
          Load_daily_range.STR = paste0(round(mean(Loads_15lb.STR))," [",
                                  round(min(Loads_15lb.STR)),", ",
                                  round(max(Loads_15lb.STR)),"]"))

monthly_summary = Incomes_monthly %>% group_by(yearmonth) %>%
  reframe(
    Total_Units = sum(Times,na.rm=T),
    STR_Units = sum(Times[!Type %in% "Residential"],na.rm=T),
    Residential_Units = sum(Times[Type %in% "Residential"],na.rm=T),
    CleaningIncome = sum(CleaningIncome, na.rm = TRUE))

monthly_summary = merge(monthly_summary,payCleaner %>% 
                group_by(yearmonth) %>% 
                reframe(Days =length(unique(Day)),
                        CleaningCost= sum(Rate,na.rm=T)),
                        by="yearmonth") %>%
    mutate(delta_income_cost = round(CleaningIncome -CleaningCost,2),
           Cost_perc = paste0(round(CleaningCost/CleaningIncome*100,2),"%"))%>%
    mutate(Avg_cleanings_per_day = round(Total_Units/Days),
            AvgCleaningCost_perUnit = round(CleaningCost/Total_Units,2))

monthly_summary = monthly_summary %>% 
            filter(!yearmonth %in% c("2025-05")) %>%
            select(yearmonth,Days,Total_Units,STR_Units,Residential_Units,
                   CleaningIncome,CleaningCost,delta_income_cost,Cost_perc,
                   Avg_cleanings_per_day,AvgCleaningCost_perUnit)
monthly_summary= merge(monthly_summary,monthly_load,by='yearmonth')

total_row <- monthly_summary %>%
  summarise(
    yearmonth = "Total", # Label for the total row
    Load_daily_range.STR ="",
    across(where(is.numeric), sum,na.rm=T) # Sum all numeric columns
  ) %>%
mutate(Cost_perc = paste0(round(CleaningCost/CleaningIncome*100,2),"%"),
       AvgCleaningCost_perUnit = round(CleaningCost/Total_Units,2))

monthly_summary = rbind(monthly_summary,total_row)

outable = cbind(data.frame(Features = colnames(monthly_summary),
                     t(monthly_summary)))
colnames(outable) = outable[1,]
outable = outable[-1,]
outable[,-1] %>%
  kable(digits = 2,caption="Key Performance Summary",align = "lrrrrrr") %>%
  kable_styling(full_width =F, position = "left")
```

```{r plot-data-prep}
summary_stats_daily = daily %>% group_by(yearmonth) %>%
    reframe(
    Days = n(),
    Total_Units = sum(units, na.rm = TRUE),
    STR_Units = sum(units - units_residential, na.rm = TRUE),
    Residential_Units = sum(units_residential, na.rm = TRUE),
    CleaningIncome = sum(CleaningIncome, na.rm = TRUE),
    CleaningCost = sum(CleaningCost, na.rm = TRUE),
    Loads_15lb.STR = sum(totalweight.STR,na.rm=T)/15,
    delta_income_cost = round(CleaningIncome -CleaningCost,2),
    Cost_perc = paste0(round(CleaningCost/CleaningIncome*100,2),"%"),
    AvgCleaningCost_perUnit = round(CleaningCost/Total_Units,2)) %>%
  mutate(Avg_cleanings_per_day = round(Total_Units/Days))
# Prepare data for plotting
dataplot = daily %>% 
  filter(Cleaning.Date >= start_date & Cleaning.Date <=end_date) %>%
  select(Cleaning.Date, CleaningIncome, CleaningIncome.STR, 
         CleaningIncome.Residential, CleaningCost,
         CleaningCost_cumsum, CleaningIncome_cumsum, 
         CleaningIncome_STR_cum, CleaningIncome_Residential_cum) %>% 
  pivot_longer(!Cleaning.Date, values_to = 'Amount') %>%
  mutate(cleaning_date = as.POSIXct(Cleaning.Date),
         Month = substr(Cleaning.Date, 1, 7)) 

# Weekly summary for plotting
weekplot = daily %>% 
  group_by(Week) %>%
  reframe(CleaningIncome = sum(CleaningIncome),
          CleaningIncome.STR = sum(CleaningIncome.STR, na.rm = T),
          CleaningIncome.Residential = sum(CleaningIncome.Residential, na.rm = T),
          CleaningCost = sum(CleaningCost, na.rm = T)) %>%
  pivot_longer(!Week, values_to = 'Amount') %>%
  mutate(Month = substr(Week, 1, 7),
         week = as.POSIXct(Week))
```

```{r daily-plot,fig.height=7}
dataplot %>% 
  filter(cleaning_date <= end_date & name %in% c("CleaningIncome", "CleaningCost")) %>%
  ggplot(aes(cleaning_date, Amount, group = name, color = name)) +
  geom_point(size = 1) +
  geom_line() +
  facet_wrap(~Month, ncol = 1, scales = "free_x") +
  labs(x = "Cleaning Date", 
       y = "Amount ($)", 
       color = "",
   title = "Comparison of CleaningIncome (cleaning fee) vs CleaningCost (pay cleaner)") +
  theme_minimal() +
  theme(legend.position = 'top')
```

```{r cumulative-plot, fig.height=7}
dataplot %>% 
  filter(cleaning_date <= end_date & 
         name %in% c("CleaningIncome_cumsum", "CleaningCost_cumsum")) %>%
  ggplot(aes(cleaning_date, Amount, group = name, color = name)) +
  geom_point(size = 1) +
  geom_line() +
  facet_wrap(~Month, ncol = 1, scales = "free") +
  labs(x = "Cleaning Date", 
       y = "Cumulative Amount ($)", 
       color = "",
       title = "Cumulative Daily CleaningIncome vs CleaningCost") +
  theme_minimal() +
  theme(legend.position = 'top') 
```

```{r weekly-plot}
weekplot %>% 
  filter(week <= end_date & name %in% c("CleaningIncome", "CleaningCost")) %>%
  ggplot(aes(week, Amount, group = name, color = name)) +
  geom_point() +
  geom_line() +	
  scale_x_datetime(date_breaks = '7 day', labels = date_format("%m-%d")) +
  labs(x = "Week Ending (Friday)", 
       y = "Weekly Amount ($)", 
       color = "",
       title = "Aggregated weekly comparison of CleaningIncome (cleaning fee) vs CleaningCost (pay cleaner)") +
  theme_minimal() +
  theme(legend.position = 'top',
        axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r service-breakdown,fig.height=3}
service_summary = daily %>%
  summarise(
    STR_Cleanings = sum(units - units_residential, na.rm = TRUE),
    Residential_Cleanings = sum(units_residential, na.rm = TRUE),
    STR_Income = sum(CleaningIncome.STR, na.rm = TRUE),
    Residential_Income = sum(CleaningIncome.Residential, na.rm = TRUE)
  ) %>%
  pivot_longer(everything(), names_to = c("Service_Type", "Metric"), 
               names_pattern = "(.*)_(.*)", values_to = "Value")
```

# By month Analysis

With dispatch data, we are able to compare cleaner pay rate and income, and property cleaning cost and income.

## Cleaner payout

For each cleaner, their incomes from each property are the total income divided by the number of cleaners. The solid line is current pay rate for the cleaner.

#### Cleaning Incomes vs Cost

```{r,fig.height=10,fig.width=9,results='asis'}
cleaner_all_sum = cleaner_paids %>% 
  mutate(yearmonth = format(Cleaning.Date,"%y-%m"),
         Units = as.integer(Units)) %>% 
  group_by(cleaner,Rate) %>% 
  reframe(Total_Units = sum(Units),
          Income = sum(income),
          Cost = sum(Rate),
          delta_Income_Cost = Income-Cost,
          Income_per_unit=round(Income/Total_Units,2),
          Cost_per_unit = round(Cost/Total_Units,2)) %>%
  arrange(delta_Income_Cost)

cleaner_monthly_sum = cleaner_paids %>% 
  mutate(cleaner = format(Cleaning.Date,"%Y-%m"),
         Units = as.integer(Units)) %>% 
  group_by(cleaner) %>% 
  reframe(Income = sum(income),
          Cost = sum(Rate),
          delta_Income_Cost = Income-Cost,
          #Income_per_unit=round(Income/Total_Units,2),
          #Cost_per_unit = round(Cost/Total_Units,2),
          Rate=round(mean(Rate))) 

total_row <- cleaner_all_sum %>%
  summarise(
    cleaner = "Summary", # Label for the total row
    across(where(is.numeric), sum,na.rm=T) # Sum all numeric columns
  ) %>% mutate(Rate=round(Rate/nrow(cleaner_all_sum)),
               Income_per_unit = Income/Total_Units,
               Cost_per_unit = Cost/Total_Units)
cleaner_all_sum = rbind.fill(total_row,cleaner_monthly_sum,cleaner_all_sum) 

cleaner_all_sum %>%
    mutate(delta_Income_Cost = round(delta_Income_Cost,2)) %>%
     mutate(delta_Income_Cost = cell_spec(delta_Income_Cost, 
                           color = ifelse(delta_Income_Cost < 0, "red", "green"))) %>%
    kable(escape = FALSE, format = "html",digits = 2,align = "lrrrrrrr") %>%
    kable_styling("striped",full_width =F, position = "left") %>%
    row_spec(1:(length(months)+1),hline=T,bold=T,background = 'lightgrey') 


# DT::datatable(options = list(pageLength = nrow(cleaner_all_sum), 
#                                scrollX = T),rownames = F) %>%
#   DT::formatCurrency(c("Income","Cost","delta_Income_Cost",
#                        "Income_per_unit","Cost_per_unit")) %>%
#   formatStyle(
#     columns = 0,
#     fontWeight = styleInterval(9, c('bold', 'weight')))

cleaner_paids %>%
  filter(Cleaning.Date >= start_date & Cleaning.Date <=end_date) %>%
  ggplot(aes(Cleaning.Date,income,color=cleaner)) +
  geom_line()+
  geom_point()+
  geom_hline(aes(yintercept = Rate)) +
  facet_wrap(~cleaner,ncol=2,axes="all_x",scale='free') +
  labs(x="Cleaning Date",y='Income') +
  theme(legend.position = "none")
```

#### Cleaning Incomes vs Cost by Month

```{r}
cleaner_sum = cleaner_paids %>% 
  mutate(yearmonth = format(Cleaning.Date,"%Y-%m"),
         Units = as.integer(Units),
         unit_income=income/Units) %>% 
  group_by(yearmonth,cleaner,Rate) %>% 
  reframe(Total_Units = sum(Units),
          Income = sum(income),
          Cost = sum(Rate),
          delta_Income_Cost = Income-Cost,
          Income_per_unit=round(Income/Total_Units,2),
          Cost_per_unit = round(Cost/Total_Units,2)) 

cleaner_sum %>% 
  DT::datatable(options = list(pageLength = 12, scrollX = T),rownames = F) %>%
  DT::formatCurrency(c("Income","Cost","delta_Income_Cost",
                       "Income_per_unit","Cost_per_unit")) %>%
  formatStyle(7, color = styleInterval(0, c("red", "black")))


#  mutate_at(c("Paid","income","avg_income_unit","median_income_unit"),round,2) %>%
 # kable(digits = 2,caption="Cleaner Incomes vs Pay Rate") %>%
  #kable_styling(full_width =F, position = "left")
```

## Property cleaning cost

For each property, I set a cleaning weigth according to its square feet, numbers of bedroom and bathrooms

Standardize STR cleaning rate (estimated_cleaning_cost) as:

-   Base rate: \$70 for studio (no bedroom,1 bathroom, \< 600sqft), otherwise \$85
-   Additional Bedroom: +\$20 each
-   Additional Bathroom: +\$15 each
-   Laundry (per load, wash & dry): +\$12 per bedroom.

Residential cleaning rates use cleaning payout directly. Then, calculate weights for the property depending on the total properties cleaned in that day. For example, yesterday we cleaned unit 1 and unit 2, the total cleaner payout are \$400. The estimated cleaning costs are \$100 and \$150 for unit 1 and 2. Their weigths are 100/(100+150) = 0.4 and 150/(100+150) = 0.6, so cleaning costs are 400x0.4 for unit 1 and 400x0.6 for unit 2.

The solid line is current cleaning rate for the property.

#### Property Cleaning Income vs Cost

The following table is also available at [**property_all_sum.xlsx**](https://docs.google.com/spreadsheets/d/1i3dDEFnpvk1xaj3RczEU2nNs-0eu1UZ5/edit?usp=drive_web&ouid=106182578085098601729&rtpof=true). Note that Income_per_cleaning and Cost_per_cleaning for overall and monthly summary are averages among properties.

```{r,fig.height=9,fig.width=9}
property_all_sum = property_costs %>% 
  group_by(Listing) %>% 
  reframe(Times = n(),
          Income = sum(CleaningIncome),
          Cost = sum(Cost),
          delta_Income_Cost = Income-Cost,
          Income_per_cleaning = Income/Times,
          Cost_per_cleaning = Cost/Times) %>%
  arrange(delta_Income_Cost)

property_monthly_sum = property_costs %>%
  mutate(yearmonth = format(Cleaning.Date,"%Y-%m")) %>% 
  group_by(yearmonth,Listing) %>% 
  reframe(Times = n(),
          Income = sum(CleaningIncome,na.rm=T),
          Cost = sum(Cost,na.rm=T),
          delta_Income_Cost = Income-Cost,
          Income_per_cleaning = Income/Times,
          Cost_per_cleaning = Cost/Times) %>%
  group_by(Listing=yearmonth) %>% 
  reframe(Times = sum(Times,na.rm=T),
          Income = sum(Income,na.rm=T),
          Cost = sum(Cost,na.rm=T),
          delta_Income_Cost = Income-Cost,
          Income_per_cleaning = mean(Income_per_cleaning,na.rm=T),
          Cost_per_cleaning = mean(Cost_per_cleaning,na.rm=T))

property_all_sum$Type = 
  ifelse(property_all_sum$Listing %in% IncomeResid$Listing, 'Residential',"STR")

idx =property_all_sum$Type %in% "Residential" & 
  !property_all_sum$Listing %in% unique(IncomeResid$Listing)
property_all_sum$Type[idx] = paste0(property_all_sum$Type[idx] ,"/STR")

total_row <- property_all_sum %>%
  summarise(
    Listing = "Overall", 
    across(c(Times,Income,Cost,delta_Income_Cost), sum,na.rm=T),
    across(c(Income_per_cleaning,Cost_per_cleaning), mean,na.rm=T)
  ) 

property_all_sum = rbind.fill(total_row,
                              property_monthly_sum,
                              property_all_sum) 
write.xlsx(property_all_sum,"property_all_sum_20260117.xlsx",
           na.strings=c(NA,""),firstActiveRow = 2,withFilter = T)

property_all_sum %>%
    mutate(delta_Income_Cost = round(delta_Income_Cost,2)) %>%
    mutate(delta_Income_Cost = cell_spec(delta_Income_Cost, 
            color = ifelse(!is.na(delta_Income_Cost) & delta_Income_Cost < 0,
            "red", "green"))) %>%
    kable(escape = FALSE, format = "html",digits = 2,align = "lrrrrrrrr") %>%
    kable_styling("striped",full_width =F, position = "left") %>%
    row_spec(1:(length(months)+1),hline=T,bold=T,background = 'lightgrey') 

properties = sort(unique(property_costs$Listing))
chuck_size = 6 
split_vector <- split(properties, ceiling(seq_along(properties)/chuck_size))

for(i in split_vector)
print(property_costs %>% filter(Listing %in% i) %>%
   filter(Cleaning.Date >= start_date & Cleaning.Date <=end_date) %>%
ggplot(aes(Cleaning.Date,Cost,color=Listing)) +
  geom_line()+
  geom_point()+
  geom_hline(aes(yintercept = CleaningIncome)) +
  facet_wrap(~Listing,ncol=2,axes="all_x",scale='free') +
  labs(x="Cleaning Date",y='Cleaning Cost')+
  theme(legend.position = "none"))

property_sum = property_costs %>%
  mutate(yearmonth = format(Cleaning.Date,"%Y-%m")) %>% 
  group_by(yearmonth,Listing) %>% 
  reframe(Times = n(),
          Income = sum(CleaningIncome),
          Cost = sum(Cost),
          delta_Income_Cost = Income-Cost,
          IncomePerClean = Income/Times,
          CostPerClean = Cost/Times) 

```

#### Property cleaning Income vs Cost by month

```{r,fig.height=9,fig.width=9}
property_sum %>% 
  DT::datatable(options = list(pageLength = 12, scrollX = T),rownames = F) %>%
  DT::formatCurrency(c("Income","Cost","delta_Income_Cost","IncomePerClean",
                       "CostPerClean")) %>%
  formatStyle(6, color = styleInterval(0, c("red", "black")))
#  kable(digits = 2,caption="Property cleaning Incomes vs Cost",) %>%
#  kable_styling(full_width =F, position = "left")
```